<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThaiNovel - ‡∏≠‡πà‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .novel-text { font-family: 'Sarabun', sans-serif; line-height: 1.8; }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        
        .theme-light { background-color: #ffffff; color: #333333; }
        .theme-sepia { background-color: #f4ecd8; color: #5b4636; }
        .theme-dark { background-color: #1a202c; color: #e2e8f0; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 flex flex-col min-h-screen">

    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2 cursor-pointer" onclick="goHome()">
                <div class="w-10 h-10 bg-green-600 rounded-xl flex items-center justify-center text-white">
                    <i class="fa-solid fa-book-open text-xl"></i>
                </div>
                <span class="text-2xl font-bold text-green-900 tracking-tight hidden sm:block">ThaiNovel (Sheets)</span>
            </div>

            <div class="flex-1 max-w-xl mx-4 hidden md:block">
                <div class="relative">
                    <input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢, ‡∏ô‡∏±‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô..." class="w-full bg-gray-100 rounded-full py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-green-500 transition-all">
                    <i class="fa-solid fa-magnifying-glass absolute left-4 top-3 text-gray-400"></i>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <button class="text-gray-500 hover:text-green-600 font-medium px-4">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>
    </header>

    <main id="app-content" class="flex-1 w-full max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <div class="py-20 text-center text-gray-500" id="loading-state">
            <i class="fa-solid fa-spinner fa-spin text-3xl mb-4"></i><br>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...
        </div>
    </main>

    <footer class="bg-white border-t border-gray-200 mt-auto py-6">
        <div class="max-w-7xl mx-auto px-4 text-center text-gray-500 text-sm">
            &copy; 2026 ThaiNovel ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡πà‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
        </div>
    </footer>

    <script>
        // üî• ‡∏ô‡∏≥ URL ‡∏Ç‡∏≠‡∏á Web App ‡∏à‡∏≤‡∏Å Google Apps Script ‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà üî•
        const GOOGLE_SHEET_API_URL = "https://script.google.com/macros/s/AKfycbzA1ZXHWBEXuwp4Gmu8SEc9q8WKUYi33NA8t1AixdE8PF2rXfklGQ6H6Z6vxCW--39J/exec"; 

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        let novels = [];
        let chapters = [];
        let state = {
            view: 'home', 
            activeNovelId: null,S
            activeChapterId: null,
            readerSettings: { fontSize: 18, theme: 'theme-light' }
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets
        async function loadDataFromExcel() {
            try {
                // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà URL ‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏Ç‡∏≤‡∏ß
                if (GOOGLE_SHEET_API_URL === "‡πÉ‡∏™‡πà_URL_‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å_Google_Apps_Script_‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ") {
                    document.getElementById('loading-state').innerHTML = '<i class="fa-solid fa-triangle-exclamation text-yellow-500 text-3xl mb-4"></i><br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Sheets ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö';
                    return;
                }

                const response = await fetch(GOOGLE_SHEET_API_URL);
                const data = await response.json();
                
                // ‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏à‡∏≤‡∏Å String ("‡πÅ‡∏ü‡∏ô‡∏ï‡∏≤‡∏ã‡∏µ, ‡∏£‡∏∞‡∏ö‡∏ö") ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Array
                novels = data.novels.map(n => ({
                    ...n,
                    views: parseInt(n.views) || 0,
                    categories: n.categories ? n.categories.toString().split(',').map(s => s.trim()) : []
                }));
                chapters = data.chapters;
                
                render();
            } catch (error) {
                console.error("Error loading data:", error);
                document.getElementById('loading-state').innerHTML = '<i class="fa-solid fa-circle-xmark text-red-500 text-3xl mb-4"></i><br>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Excel';
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö
        loadDataFromExcel();

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô UI
        function render() {
            const appDiv = document.getElementById('app-content');
            if (state.view === 'home') appDiv.innerHTML = renderHome();
            else if (state.view === 'detail') appDiv.innerHTML = renderNovelDetail();
            else if (state.view === 'read') appDiv.innerHTML = renderReader();
            window.scrollTo(0, 0);
        }

        function renderHome() {
            let html = `
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
                    <p class="text-gray-500">‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢‡∏™‡∏ô‡∏∏‡∏Å‡πÜ ‡∏°‡∏≤‡∏Å‡∏°‡∏≤‡∏¢‡∏£‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà</p>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 sm:gap-6">
            `;

            if (novels.length === 0) html += `<div class="col-span-full py-20 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>`;

            novels.forEach(novel => {
                let displayViews = novel.views || 0;
                html += `
                    <div class="bg-white rounded-xl shadow-sm hover:shadow-xl transition-shadow overflow-hidden cursor-pointer group flex flex-col h-full" onclick="viewNovel('${novel.id}')">
                        <div class="relative aspect-[2/3] overflow-hidden">
                            <img src="${novel.cover}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" onerror="this.src='https://via.placeholder.com/400x600?text=No+Cover'">
                            <div class="absolute top-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded-md">
                                <i class="fa-solid fa-eye text-[10px]"></i> ${displayViews.toLocaleString()}
                            </div>
                        </div>
                        <div class="p-4 flex flex-col flex-grow">
                            <h3 class="font-bold text-gray-900 leading-tight mb-1 group-hover:text-green-600 line-clamp-2">${novel.title}</h3>
                            <p class="text-sm text-gray-500 mb-2"><i class="fa-solid fa-pen-nib text-xs mr-1"></i> ${novel.author}</p>
                            <div class="mt-auto pt-2 flex flex-wrap gap-1">
                                ${novel.categories ? novel.categories.slice(0, 2).map(cat => `<span class="text-[10px] bg-green-50 text-green-600 px-2 py-1 rounded">#${cat}</span>`).join('') : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            return html + `</div>`;
        }

        function renderNovelDetail() {
            const novel = novels.find(n => n.id === state.activeNovelId);
            if (!novel) return goHome();

            const novelChapters = chapters.filter(c => c.novelId === novel.id).sort((a, b) => a.chapterNumber - b.chapterNumber);
            let chaptersHtml = novelChapters.length === 0 ? `<div class="p-8 text-center text-gray-500 bg-gray-50 rounded-lg">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡πà‡∏≤‡∏ô</div>` : '';
            
            novelChapters.forEach(ch => {
                chaptersHtml += `
                    <div onclick="readChapter('${ch.id}')" class="flex items-center justify-between p-4 bg-white border border-gray-100 hover:border-green-300 hover:shadow-md rounded-xl cursor-pointer transition-all mb-3 group">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-green-50 text-green-600 rounded-full flex items-center justify-center font-bold">${ch.chapterNumber}</div>
                            <div>
                                <h4 class="font-bold text-gray-800 group-hover:text-green-600 transition-colors">‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà ${ch.chapterNumber}: ${ch.title}</h4>
                            </div>
                        </div>
                        <i class="fa-solid fa-chevron-right text-gray-300 group-hover:text-green-600"></i>
                    </div>
                `;
            });

            return `
                <button onclick="goHome()" class="flex items-center gap-2 text-gray-500 hover:text-green-600 font-medium mb-6 transition-colors">
                    <i class="fa-solid fa-arrow-left"></i> ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                </button>
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden mb-8">
                    <div class="flex flex-col md:flex-row">
                        <div class="w-full md:w-1/3 lg:w-1/4 p-6 bg-gray-50 flex justify-center items-start">
                            <img src="${novel.cover}" class="w-48 md:w-full rounded-lg shadow-md aspect-[2/3] object-cover" onerror="this.src='https://via.placeholder.com/400x600?text=No+Cover'">
                        </div>
                        <div class="p-6 md:p-8 flex-1 flex flex-col">
                            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 mb-2">${novel.title}</h1>
                            <p class="text-lg text-gray-600 mb-6"><i class="fa-solid fa-pen-nib mr-2"></i>‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á: ${novel.author}</p>
                            <div class="flex gap-6 mb-6 pb-6 border-b border-gray-100">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-gray-900">${(novel.views || 0).toLocaleString()}</div>
                                    <div class="text-xs text-gray-500 uppercase tracking-wider">‡∏¢‡∏≠‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°</div>
                                </div>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-3">‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠</h3>
                            <p class="text-gray-600 leading-relaxed novel-text bg-gray-50 p-4 rounded-xl border border-gray-100">${novel.synopsis}</p>
                        </div>
                    </div>
                </div>
                <div class="max-w-4xl">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2"><i class="fa-solid fa-list-ul text-green-600"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    <div class="flex flex-col">${chaptersHtml}</div>
                </div>
            `;
        }

        function renderReader() {
            const chapter = chapters.find(c => c.id === state.activeChapterId);
            if (!chapter) return viewNovel(state.activeNovelId);
            const novel = novels.find(n => n.id === chapter.novelId);
            const novelChapters = chapters.filter(c => c.novelId === novel.id).sort((a, b) => a.chapterNumber - b.chapterNumber);
            const currentIndex = novelChapters.findIndex(c => c.id === chapter.id);
            const prevCh = currentIndex > 0 ? novelChapters[currentIndex - 1] : null;
            const nextCh = currentIndex < novelChapters.length - 1 ? novelChapters[currentIndex + 1] : null;

            return `
                <div class="${state.readerSettings.theme} min-h-screen -mt-4 sm:-mt-6 lg:-mt-8 -mx-4 sm:-mx-6 lg:-mx-8 p-4 sm:p-8 transition-colors duration-300" id="reader-container">
                    <div class="max-w-3xl mx-auto bg-black/5 backdrop-blur-sm rounded-2xl p-4 mb-8 flex flex-wrap justify-between items-center gap-4 sticky top-20 z-40">
                        <button onclick="viewNovel('${novel.id}')" class="flex items-center gap-2 font-medium hover:opacity-70">
                            <i class="fa-solid fa-arrow-left"></i> ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç
                        </button>
                        <div class="flex items-center gap-4 bg-white/50 px-4 py-2 rounded-full">
                            <span class="text-sm font-bold opacity-70">‡∏Ç‡∏ô‡∏≤‡∏î‡∏≠‡∏±‡∏Å‡∏©‡∏£</span>
                            <button onclick="changeFontSize(-2)" class="w-8 h-8 rounded-full bg-white shadow hover:bg-gray-100 text-black">A-</button>
                            <span class="text-sm font-bold w-6 text-center" id="font-size-display">${state.readerSettings.fontSize}</span>
                            <button onclick="changeFontSize(2)" class="w-8 h-8 rounded-full bg-white shadow hover:bg-gray-100 text-black">A+</button>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="changeTheme('theme-light')" class="w-8 h-8 rounded-full border-2 border-gray-300 bg-white" title="‡∏™‡∏ß‡πà‡∏≤‡∏á"></button>
                            <button onclick="changeTheme('theme-sepia')" class="w-8 h-8 rounded-full border-2 border-gray-300 bg-[#f4ecd8]" title="‡∏ñ‡∏ô‡∏≠‡∏°‡∏™‡∏≤‡∏¢‡∏ï‡∏≤"></button>
                            <button onclick="changeTheme('theme-dark')" class="w-8 h-8 rounded-full border-2 border-gray-500 bg-[#1a202c]" title="‡∏°‡∏∑‡∏î"></button>
                        </div>
                    </div>
                    <div class="max-w-3xl mx-auto bg-transparent">
                        <h4 class="text-center font-bold opacity-60 mb-2">${novel.title}</h4>
                        <h1 class="text-3xl font-bold text-center mb-10 pb-6 border-b border-current border-opacity-20">‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà ${chapter.chapterNumber} : ${chapter.title}</h1>
                        <div class="novel-text content-area transition-all duration-300" style="font-size: ${state.readerSettings.fontSize}px;">
                            ${chapter.content}
                        </div>
                        <div class="mt-16 pt-8 border-t border-current border-opacity-20 flex justify-between items-center pb-20">
                            ${prevCh ? `<button onclick="readChapter('${prevCh.id}')" class="px-6 py-3 rounded-full bg-current bg-opacity-10 font-bold"><i class="fa-solid fa-chevron-left"></i> ‡∏Å‡∏•‡∏±‡∏ö</button>` : `<div></div>`}
                            ${nextCh ? `<button onclick="readChapter('${nextCh.id}')" class="px-6 py-3 rounded-full bg-green-600 text-white font-bold">‡∏ï‡πà‡∏≠‡πÑ‡∏õ <i class="fa-solid fa-chevron-right"></i></button>` : `<div class="opacity-50 font-bold">‡∏à‡∏ö</div>`}
                        </div>
                    </div>
                </div>
            `;
        }

        // ‡∏ú‡∏π‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö window
        window.goHome = function() { state.view = 'home'; render(); }
        
        window.viewNovel = function(id) {
            // ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏ß‡∏¥‡∏ß‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Google Sheets
            if (state.view === 'home') {
                // ‡∏ö‡∏ß‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                let n = novels.find(n => n.id === id);
                if (n) n.views += 1;
                
                // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡πÉ‡∏ô Excel (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á)
                if(GOOGLE_SHEET_API_URL.includes("script.google.com")) {
                    fetch(GOOGLE_SHEET_API_URL, {
                        method: 'POST',
                        body: JSON.stringify({ action: 'incrementView', id: id })
                    }).catch(e => console.error("Error updating views:", e));
                }
            }
            state.view = 'detail';
            state.activeNovelId = id;
            render();
        }

        window.readChapter = function(id) {
            state.view = 'read';
            state.activeChapterId = id;
            const ch = chapters.find(c => c.id === id);
            if(ch) state.activeNovelId = ch.novelId;
            render();
        }

        window.changeFontSize = function(delta) {
            let newSize = state.readerSettings.fontSize + delta;
            if (newSize >= 14 && newSize <= 32) {
                state.readerSettings.fontSize = newSize;
                document.getElementById('font-size-display').innerText = newSize;
                document.querySelector('.content-area').style.fontSize = newSize + 'px';
            }
        }

        window.changeTheme = function(themeName) {
            state.readerSettings.theme = themeName;
            document.getElementById('reader-container').className = `${themeName} min-h-screen -mt-4 sm:-mt-6 lg:-mt-8 -mx-4 sm:-mx-6 lg:-mx-8 p-4 sm:p-8 transition-colors duration-300`;
        }

    </script>
</body>
</html>
